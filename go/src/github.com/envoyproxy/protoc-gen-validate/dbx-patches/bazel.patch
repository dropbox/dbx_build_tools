diff -ruN 1/bazel/BUILD.in 2/bazel/BUILD.in
--- 1/bazel/BUILD.in	1970-01-01 00:00:00.000000000 +0000
+++ 2/bazel/BUILD.in	2022-05-24 19:15:06.044006297 +0000
@@ -0,0 +1,13 @@
+load("@bazel_skylib//rules:common_settings.bzl", "string_flag")
+
+config_setting(
+    name = "windows_x86_64",
+    values = {"cpu": "x64_windows"},
+    visibility = ["//visibility:public"],
+)
+
+string_flag(
+    name = "template-flavor",
+    build_setting_default = "",
+    visibility = ["//visibility:public"],
+)
diff -ruN 1/example-workspace/WORKSPACE 2/example-workspace/WORKSPACE
--- 1/example-workspace/WORKSPACE	2022-05-24 19:15:05.576007942 +0000
+++ 2/example-workspace/WORKSPACE	1970-01-01 00:00:00.000000000 +0000
@@ -1,25 +0,0 @@
-# Initialize this as a self-contained Bazel workspace.
-workspace(name = "pgv_example")
-
-# Declare the protoc-gen-validate repository as an external dependency.
-# This uses a local_repository declaration because this workspace is part of
-# the same Git repository. External repositories should declare PGV as a
-# dependency using http_repository pointed at the PGV GitHub repository.
-local_repository(
-    name = "com_envoyproxy_protoc_gen_validate",
-    path = "../",
-)
-
-# Load the dependencies of PGV. This is required for the next step to work.
-load("@com_envoyproxy_protoc_gen_validate//bazel:repositories.bzl", "pgv_dependencies")
-
-pgv_dependencies()
-
-# Perform any necessary actions to initialize dependencies.
-load("@com_envoyproxy_protoc_gen_validate//bazel:dependency_imports.bzl", "pgv_dependency_imports")
-
-pgv_dependency_imports()
-
-load("@com_envoyproxy_protoc_gen_validate//:dependencies.bzl", "go_third_party")
-
-go_third_party()
diff -ruN 1/example-workspace/example.cc 2/example-workspace/example.cc
--- 1/example-workspace/example.cc	2022-05-24 19:15:05.580007927 +0000
+++ 2/example-workspace/example.cc	1970-01-01 00:00:00.000000000 +0000
@@ -1,56 +0,0 @@
-#include <fcntl.h>
-#include <unistd.h>
-
-#include <cstdlib>
-#include <ostream>
-
-#include "google/protobuf/io/zero_copy_stream_impl.h"
-#include "google/protobuf/text_format.h"
-#include "foo/bar.pb.h"
-#include "foo/bar.pb.validate.h"
-
-int main(const int nargs, const char** const args) {
-  if (nargs <= 1) {
-    std::cout << "No inputs provided; exiting" << std::endl;
-    return EXIT_SUCCESS;
-  }
-
-  int success_count = 0;
-  for (int i = 1; i < nargs; ++i) {
-    pgv::example::foo::Bars bars;
-    const auto filename = args[i];
-    const auto fd = ::open(filename, O_RDONLY);
-    if (fd < 0) {
-      std::cerr << "Failed to open file '" << filename << "'" << std::endl;
-      continue;
-    }
-    google::protobuf::io::FileInputStream input(fd);
-    input.SetCloseOnDelete(true);
-
-    if (!google::protobuf::TextFormat::Parse(&input, &bars)) {
-      std::cerr << "Failed to parse file '" << filename << "' as a "
-                << bars.GetDescriptor()->full_name() << " textproto" << std::endl;
-      return EXIT_FAILURE;
-    }
-
-    pgv::ValidationMsg error_message;
-    if (Validate(bars, &error_message)) {
-      std::cout << "Successfully validated file '" << filename << "' as a "
-                << bars.GetDescriptor()->full_name() << " textproto"
-                << std::endl;
-      ++success_count;
-    } else {
-      std::cerr << "Failed to validate file '" << filename << "' as a "
-                << bars.GetDescriptor()->full_name()
-                << " textproto: " << error_message << std::endl;
-    }
-  }
-
-  const int failure_count = nargs - 1 - success_count;
-  if (failure_count != 0) {
-    std::cerr << "Failed to validate " << failure_count << " file"
-              << (failure_count == 1 ? "" : "s") << std::endl;
-    return EXIT_FAILURE;
-  }
-  return EXIT_SUCCESS;
-}
diff -ruN 1/example-workspace/example.py 2/example-workspace/example.py
--- 1/example-workspace/example.py	2022-05-24 19:15:05.584007914 +0000
+++ 2/example-workspace/example.py	1970-01-01 00:00:00.000000000 +0000
@@ -1,50 +0,0 @@
-import sys
-
-from google.protobuf import text_format
-from foo import bar_pb2
-from com_envoyproxy_protoc_gen_validate.python.protoc_gen_validate import validator
-from typing import List
-
-
-def main(filenames: List[str]) -> None:
-    if not filenames:
-        print("No inputs provided; exiting")
-
-    success_count = 0
-    for filename in filenames:
-        bars = bar_pb2.Bars()
-        fullname = bars.DESCRIPTOR.name
-        try:
-            with open(filename, 'r') as fh:
-                text_format.Parse(fh.read(), bars)
-        except IOError as error:
-            msg = f"Failed to open file '{filename}': {error}"
-            raise RuntimeError(msg) from error
-        except text_format.ParseError as error:
-            msg = f"Failed to parse file '{filename}' as a {fullname} textproto: {error}"
-            raise RuntimeError(msg) from error
-
-        try:
-            validator.validate(bars)
-        except validator.ValidationFailed as error:
-            print(
-                f"Failed to validate file '{filename}' as a {fullname} textproto: {error}",
-                file=sys.stderr,
-            )
-        else:
-            print(f"Successfully validated file '{filename}' as a {fullname} textproto")
-            success_count += 1
-
-    failure_count = len(filenames) - success_count
-    if failure_count:
-        s = "s" if failure_count > 1 else ""
-        msg = f"Failed to validate {failure_count} file{s}"
-        raise RuntimeError(msg)
-
-
-if __name__ == "__main__":
-    try:
-        main(sys.argv[1:])
-    except RuntimeError as error:
-        print(error, file=sys.stderr)
-        sys.exit(1)
diff -ruN 1/example-workspace/example_test.sh 2/example-workspace/example_test.sh
--- 1/example-workspace/example_test.sh	2022-05-24 19:15:05.588007899 +0000
+++ 2/example-workspace/example_test.sh	1970-01-01 00:00:00.000000000 +0000
@@ -1,10 +0,0 @@
-#!/bin/bash
-#
-
-BINARY=$1
-EXPECTED_EXIT_CODE=$2
-FILENAME=$3
-
-"${BINARY}" "${FILENAME}"
-
-test $? -eq ${EXPECTED_EXIT_CODE}
diff -ruN 1/example-workspace/foo/bar.proto 2/example-workspace/foo/bar.proto
--- 1/example-workspace/foo/bar.proto	2022-05-24 19:15:05.592007885 +0000
+++ 2/example-workspace/foo/bar.proto	1970-01-01 00:00:00.000000000 +0000
@@ -1,18 +0,0 @@
-syntax = "proto3";
-
-package pgv.example.foo;
-
-import "validate/validate.proto";
-
-message BarNone {
-  int32 value = 1;
-}
-
-message BarOne {
-  int32 value = 1 [(validate.rules).int32 = { not_in: 1 }];
-}
-
-message Bars {
-  BarNone bar_none = 1;
-  BarOne bar_one = 2;
-}
diff -ruN 1/example-workspace/foo/baz_cc_test.cc 2/example-workspace/foo/baz_cc_test.cc
--- 1/example-workspace/foo/baz_cc_test.cc	2022-05-24 19:15:05.596007871 +0000
+++ 2/example-workspace/foo/baz_cc_test.cc	1970-01-01 00:00:00.000000000 +0000
@@ -1,18 +0,0 @@
-#include <fcntl.h>
-#include <unistd.h>
-
-#include <cstdlib>
-#include <ostream>
-
-#include "foo/subdir_without_package/baz.pb.h"
-#include "foo/subdir_without_package/baz.pb.validate.h"
-#include "google/protobuf/io/zero_copy_stream_impl.h"
-#include "google/protobuf/text_format.h"
-
-int main(int nargs, char** args) {
-  pgv::example::foo::Baz baz;
-  pgv::ValidationMsg msg;
-  Validate(baz, &msg);
-
-  return EXIT_SUCCESS;
-}
diff -ruN 1/example-workspace/foo/subdir_without_package/baz.proto 2/example-workspace/foo/subdir_without_package/baz.proto
--- 1/example-workspace/foo/subdir_without_package/baz.proto	2022-05-24 19:15:05.600007857 +0000
+++ 2/example-workspace/foo/subdir_without_package/baz.proto	1970-01-01 00:00:00.000000000 +0000
@@ -1,9 +0,0 @@
-syntax = "proto3";
-
-package pgv.example.foo;
-
-import "validate/validate.proto";
-
-message Baz {
-  int32 not_two = 1 [(validate.rules).int32 = { not_in: 2 }];
-}
diff -ruN 1/example-workspace/invalid.textproto 2/example-workspace/invalid.textproto
--- 1/example-workspace/invalid.textproto	2022-05-24 19:15:05.604007843 +0000
+++ 2/example-workspace/invalid.textproto	1970-01-01 00:00:00.000000000 +0000
@@ -1,10 +0,0 @@
-# proto-file: src/foo/bar.proto
-# proto-message: pgv.example.foo.Bars
-
-bar_one {
-  value: 1
-}
-
-bar_none {
-  value: 5
-}
diff -ruN 1/example-workspace/valid.textproto 2/example-workspace/valid.textproto
--- 1/example-workspace/valid.textproto	2022-05-24 19:15:05.608007829 +0000
+++ 2/example-workspace/valid.textproto	1970-01-01 00:00:00.000000000 +0000
@@ -1,9 +0,0 @@
-# proto-file: src/foo/bar.proto
-# proto-message: pgv.example.foo.Bars
-
-bar_none {
-  value: 5
-}
-bar_one {
-  value: 3
-}
diff -ruN 1/python/README.md 2/python/README.md
--- 1/python/README.md	2022-05-24 19:15:05.636007730 +0000
+++ 2/python/README.md	1970-01-01 00:00:00.000000000 +0000
@@ -1,21 +0,0 @@
-# Protoc-gen-validate (PGV)
-While protocol buffers effectively guarantee the types of structured data, 
-they cannot enforce semantic rules for values. This package is a python implementation
-of [protoc-gen-validate][pgv-home], which allows for runtime validation of various 
-semantic assertions expressed as annotations on the protobuf schema. The syntax for all available annotations is
-in `validate.proto`. Implemented Python annotations are listed in the [rules comparison][rules-comparison].
-
-### Example
-```python3
-from entities_pb2 import Person
-from protoc_gen_validate.validator import validate, ValidationFailed
-
-p = Person(first_name="Foo", last_name="Bar", age=42)
-try:
-    validate(p)
-except ValidationFailed as err:
-    print(err)
-```
-
-[pgv-home]: https://github.com/envoyproxy/protoc-gen-validate
-[rules-comparison]: https://github.com/envoyproxy/protoc-gen-validate/blob/main/rule_comparison.md
\ No newline at end of file
diff -ruN 1/python/protoc_gen_validate/validator.py 2/python/protoc_gen_validate/validator.py
--- 1/python/protoc_gen_validate/validator.py	2022-05-24 19:15:05.644007703 +0000
+++ 2/python/protoc_gen_validate/validator.py	1970-01-01 00:00:00.000000000 +0000
@@ -1,1054 +0,0 @@
-import re
-import struct
-import sys
-import time
-import uuid
-from functools import lru_cache
-from ipaddress import IPv4Address, IPv6Address, ip_address
-from urllib import parse as urlparse
-
-from google.protobuf.message import Message
-from jinja2 import Template
-from validate_email import validate_email
-
-printer = ""
-
-# Well known regex mapping.
-regex_map = {
-    "UNKNOWN": "",
-    "HTTP_HEADER_NAME": r'^:?[0-9a-zA-Z!#$%&\'*+-.^_|~\x60]+$',
-    "HTTP_HEADER_VALUE": r'^[^\u0000-\u0008\u000A-\u001F\u007F]*$',
-    "HEADER_STRING": r'^[^\u0000\u000A\u000D]*$'
-}
-
-
-class ValidationFailed(Exception):
-    pass
-
-
-class ValidatingMessage(object):
-    """Wrap a proto message to cache validate functions with the message class name.
-
-    A validate function is defined per message class in protoc-gen-validate,
-     so we can reuse an already generated function for the same message class.
-    """
-
-    def __init__(self, proto_message):
-        self.DESCRIPTOR = proto_message.DESCRIPTOR
-
-    def __hash__(self):
-        return hash(self.DESCRIPTOR.full_name)
-
-    def __eq__(self, other):
-        if isinstance(other, ValidatingMessage):
-            return self.DESCRIPTOR.full_name == other.DESCRIPTOR.full_name
-        else:
-            return False
-
-
-def validate(proto_message: Message):
-    return _validate_inner(ValidatingMessage(proto_message))(proto_message)
-
-
-# Cache generated functions with the message descriptor's full_name as the cache key
-@lru_cache()
-def _validate_inner(proto_message: Message):
-    func = file_template(proto_message)
-    global printer
-    printer += func + "\n"
-    exec(func)
-    try:
-        return generate_validate
-    except NameError:
-        return locals()['generate_validate']
-
-
-def print_validate():
-    return "".join([s for s in printer.splitlines(True) if s.strip()])
-
-
-def has_validate(field):
-    if field.GetOptions() is None:
-        return False
-    for option_descriptor, option_value in field.GetOptions().ListFields():
-        if option_descriptor.full_name == "validate.rules":
-            return True
-    return False
-
-
-def byte_len(s):
-    try:
-        return len(s.encode('utf-8'))
-    except:  # noqa
-        return len(s)
-
-
-def _validateHostName(host):
-    if not host:
-        return False
-    if len(host) > 253:
-        return False
-
-    if host[-1] == '.':
-        host = host[:-1]
-
-    for part in host.split("."):
-        if len(part) == 0 or len(part) > 63:
-            return False
-
-        # Host names cannot begin or end with hyphens
-        if part[0] == "-" or part[-1] == '-':
-            return False
-        for r in part:
-            if (r < 'A' or r > 'Z') and (r < 'a' or r > 'z') and (r < '0' or r > '9') and r != '-':
-                return False
-    return True
-
-
-def _validateEmail(addr):
-    if '<' in addr and '>' in addr:
-        addr = addr.split("<")[1].split(">")[0]
-
-    if not validate_email(addr):
-        return False
-
-    if len(addr) > 254:
-        return False
-
-    parts = addr.split("@")
-    if len(parts[0]) > 64:
-        return False
-    return _validateHostName(parts[1])
-
-
-def _has_field(message_pb, property_name):
-    # NOTE: As of proto3, HasField() only works for message fields, not for
-    #       singular (non-message) fields. First try to use HasField and
-    #       if it fails (with a ValueError) we manually consult the fields.
-    try:
-        return message_pb.HasField(property_name)
-    except:  # noqa
-        all_fields = set([field.name for field in message_pb.DESCRIPTOR.fields])
-        return property_name in all_fields
-
-
-def const_template(option_value, name):
-    const_tmpl = """{%- if str(o.string) and o.string.HasField('const') -%}
-    if {{ name }} != \"{{ o.string['const'] }}\":
-        raise ValidationFailed(\"{{ name }} not equal to {{ o.string['const'] }}\")
-    {%- elif str(o.bool) and o.bool['const'] != "" -%}
-    if {{ name }} != {{ o.bool['const'] }}:
-        raise ValidationFailed(\"{{ name }} not equal to {{ o.bool['const'] }}\")
-    {%- elif str(o.enum) and o.enum['const'] -%}
-    if {{ name }} != {{ o.enum['const'] }}:
-        raise ValidationFailed(\"{{ name }} not equal to {{ o.enum['const'] }}\")
-    {%- elif str(o.bytes) and o.bytes.HasField('const') -%}
-        {% if sys.version_info[0] >= 3 %}
-    if {{ name }} != {{ o.bytes['const'] }}:
-        raise ValidationFailed(\"{{ name }} not equal to {{ o.bytes['const'] }}\")
-        {% else %}
-    if {{ name }} != b\"{{ o.bytes['const'].encode('string_escape') }}\":
-        raise ValidationFailed(\"{{ name }} not equal to {{ o.bytes['const'].encode('string_escape') }}\")
-        {% endif %}
-    {%- endif -%}
-    """
-    return Template(const_tmpl).render(sys=sys, o=option_value, name=name, str=str)
-
-
-def in_template(value, name):
-    in_tmpl = """
-    {%- if value['in'] %}
-    if {{ name }} not in {{ value['in'] }}:
-        raise ValidationFailed(\"{{ name }} not in {{ value['in'] }}\")
-    {%- endif -%}
-    {%- if value['not_in'] %}
-    if {{ name }} in {{ value['not_in'] }}:
-        raise ValidationFailed(\"{{ name }} in {{ value['not_in'] }}\")
-    {%- endif -%}
-    """
-    return Template(in_tmpl).render(value=value, name=name)
-
-
-def string_template(option_value, name):
-    if option_value.string.well_known_regex:
-        known_regex_type = option_value.string.DESCRIPTOR.fields_by_name['well_known_regex'].enum_type
-        regex_value = option_value.string.well_known_regex
-        regex_name = known_regex_type.values_by_number[regex_value].name
-        if regex_name in ["HTTP_HEADER_NAME", "HTTP_HEADER_VALUE"] and not option_value.string.strict:
-            option_value.string.pattern = regex_map["HEADER_STRING"]
-        else:
-            option_value.string.pattern = regex_map[regex_name]
-    str_templ = """
-    {%- set s = o.string -%}
-    {% set i = 0 %}
-    {%- if s['ignore_empty'] -%}
-    if {{ name }}:
-    {% set i = 4 %}
-    {%- endif -%}
-    {% filter indent(i,True) %}
-    {{ const_template(o, name) -}}
-    {{ in_template(o.string, name) -}}
-    {%- if s['len'] %}
-    if len({{ name }}) != {{ s['len'] }}:
-        raise ValidationFailed(\"{{ name }} length does not equal {{ s['len'] }}\")
-    {%- endif -%}
-    {%- if s['min_len'] %}
-    if len({{ name }}) < {{ s['min_len'] }}:
-        raise ValidationFailed(\"{{ name }} length is less than {{ s['min_len'] }}\")
-    {%- endif -%}
-    {%- if s['max_len'] %}
-    if len({{ name }}) > {{ s['max_len'] }}:
-        raise ValidationFailed(\"{{ name }} length is more than {{ s['max_len'] }}\")
-    {%- endif -%}
-    {%- if s['len_bytes'] %}
-    if byte_len({{ name }}) != {{ s['len_bytes'] }}:
-        raise ValidationFailed(\"{{ name }} length does not equal {{ s['len_bytes'] }}\")
-    {%- endif -%}
-    {%- if s['min_bytes'] %}
-    if byte_len({{ name }}) < {{ s['min_bytes'] }}:
-        raise ValidationFailed(\"{{ name }} length is less than {{ s['min_bytes'] }}\")
-    {%- endif -%}
-    {%- if s['max_bytes'] %}
-    if byte_len({{ name }}) > {{ s['max_bytes'] }}:
-        raise ValidationFailed(\"{{ name }} length is greater than {{ s['max_bytes'] }}\")
-    {%- endif -%}
-    {%- if s['pattern'] %}
-    if re.search(r\'{{ s['pattern'] }}\', {{ name }}) is None:
-        raise ValidationFailed(\"{{ name }} pattern does not match {{ s['pattern'] }}\")
-    {%- endif -%}
-    {%- if s['prefix'] %}
-    if not {{ name }}.startswith(\"{{ s['prefix'] }}\"):
-        raise ValidationFailed(\"{{ name }} does not start with prefix {{ s['prefix'] }}\")
-    {%- endif -%}
-    {%- if s['suffix'] %}
-    if not {{ name }}.endswith(\"{{ s['suffix'] }}\"):
-        raise ValidationFailed(\"{{ name }} does not end with suffix {{ s['suffix'] }}\")
-    {%- endif -%}
-    {%- if s['contains'] %}
-    if not \"{{ s['contains'] }}\" in {{ name }}:
-        raise ValidationFailed(\"{{ name }} does not contain {{ s['contains'] }}\")
-    {%- endif -%}
-    {%- if s['not_contains'] %}
-    if \"{{ s['not_contains'] }}\" in {{ name }}:
-        raise ValidationFailed(\"{{ name }} contains {{ s['not_contains'] }}\")
-    {%- endif -%}
-    {%- if s['email'] %}
-    if not _validateEmail({{ name }}):
-        raise ValidationFailed(\"{{ name }} is not a valid email\")
-    {%- endif -%}
-    {%- if s['hostname'] %}
-    if not _validateHostName({{ name }}):
-        raise ValidationFailed(\"{{ name }} is not a valid email\")
-    {%- endif -%}
-    {%- if s['address'] %}
-    try:
-        ip_address({{ name }})
-    except ValueError:
-        if not _validateHostName({{ name }}):
-            raise ValidationFailed(\"{{ name }} is not a valid address\")
-    {%- endif -%}
-    {%- if s['ip'] %}
-    try:
-        ip_address({{ name }})
-    except ValueError:
-        raise ValidationFailed(\"{{ name }} is not a valid ip\")
-    {%- endif -%}
-    {%- if s['ipv4'] %}
-    try:
-        IPv4Address({{ name }})
-    except ValueError:
-        raise ValidationFailed(\"{{ name }} is not a valid ipv4\")
-    {%- endif -%}
-    {%- if s['ipv6'] %}
-    try:
-        IPv6Address({{ name }})
-    except ValueError:
-        raise ValidationFailed(\"{{ name }} is not a valid ipv6\")
-    {%- endif %}
-    {%- if s['uri'] %}
-    url = urlparse.urlparse({{ name }})
-    if not all([url.scheme, url.netloc, url.path]):
-        raise ValidationFailed(\"{{ name }} is not a valid uri\")
-    {%- endif %}
-    {%- if s['uri_ref'] %}
-    url = urlparse.urlparse({{ name }})
-    if not all([url.scheme, url.path]) and url.fragment:
-        raise ValidationFailed(\"{{ name }} is not a valid uri ref\")
-    {%- endif -%}
-    {%- if s['uuid'] %}
-    try:
-        uuid.UUID({{ name }})
-    except ValueError:
-        raise ValidationFailed(\"{{ name }} is not a valid UUID\")
-    {%- endif -%}
-    {% endfilter %}
-    """
-    return Template(str_templ).render(o=option_value, name=name, const_template=const_template, in_template=in_template)
-
-
-def required_template(value, name):
-    req_tmpl = """{%- if value['required'] %}
-    if not _has_field(p, \"{{ name.split('.')[-1] }}\"):
-        raise ValidationFailed(\"{{ name }} is required.\")
-    {%- endif -%}
-    """
-    return Template(req_tmpl).render(value=value, name=name)
-
-
-def message_template(option_value, name, repeated=False):
-    message_tmpl = """{%- if m.message %}
-    {{- required_template(m.message, name) }}
-    {%- endif -%}
-    {%- if m.message and m.message['skip'] %}
-    # Skipping validation for {{ name }}
-    {%- else %}
-    {% if repeated %}
-    if {{ name }}:
-    {% else %}
-    if _has_field(p, \"{{ name.split('.')[-1] }}\"):
-    {% endif %}
-        embedded = validate(p.{{ name }})
-        if embedded is not None:
-            return embedded
-    {%- endif -%}
-    """
-    return Template(message_tmpl).render(
-        m=option_value, name=name, required_template=required_template, repeated=repeated)
-
-
-def bool_template(option_value, name):
-    bool_tmpl = """
-    {{ const_template(o, name) -}}
-    """
-    return Template(bool_tmpl).render(o=option_value, name=name, const_template=const_template)
-
-
-def num_template(option_value, name, num):
-    num_tmpl = """
-    {% set i = 0 %}
-    {%- if num.HasField('ignore_empty') -%}
-    if {{ name }}:
-    {% set i = 4 %}
-    {%- endif -%}
-    {% filter indent(i,True) %}
-    {%- if num.HasField('const') and str(o.float) == "" -%}
-    if {{ name }} != {{ num['const'] }}:
-        raise ValidationFailed(\"{{ name }} not equal to {{ num['const'] }}\")
-    {%- endif -%}
-    {%- if num.HasField('const') and str(o.float) != "" %}
-    if {{ name }} != struct.unpack(\"f\", struct.pack(\"f\", ({{ num['const'] }})))[0]:
-        raise ValidationFailed(\"{{ name }} not equal to {{ num['const'] }}\")
-    {%- endif -%}
-    {{ in_template(num, name) }}
-    {%- if num.HasField('lt') %}
-        {%- if num.HasField('gt') %}
-            {%- if num['lt'] > num['gt'] %}
-    if {{ name }} <= {{ num['gt'] }} or {{ name }} >= {{ num ['lt'] }}:
-        raise ValidationFailed(\"{{ name }} is not in range {{ num['lt'], num['gt'] }}\")
-            {%- else %}
-    if {{ name }} >= {{ num['lt'] }} and {{ name }} <= {{ num['gt'] }}:
-        raise ValidationFailed(\"{{ name }} is not in range {{ num['gt'], num['lt'] }}\")
-            {%- endif -%}
-        {%- elif num.HasField('gte') %}
-            {%- if num['lt'] > num['gte'] %}
-    if {{ name }} < {{ num['gte'] }} or {{ name }} >= {{ num ['lt'] }}:
-        raise ValidationFailed(\"{{ name }} is not in range {{ num['lt'], num['gte'] }}\")
-            {%- else %}
-    if {{ name }} >= {{ num['lt'] }} and {{ name }} < {{ num['gte'] }}:
-        raise ValidationFailed(\"{{ name }} is not in range {{ num['gte'], num['lt'] }}\")
-            {%- endif -%}
-        {%- else %}
-    if {{ name }} >= {{ num['lt'] }}:
-        raise ValidationFailed(\"{{ name }} is not lesser than {{ num['lt'] }}\")
-        {%- endif -%}
-    {%- elif num.HasField('lte') %}
-        {%- if num.HasField('gt') %}
-            {%- if num['lte'] > num['gt'] %}
-    if {{ name }} <= {{ num['gt'] }} or {{ name }} > {{ num ['lte'] }}:
-        raise ValidationFailed(\"{{ name }} is not in range {{ num['lte'], num['gt'] }}\")
-            {%- else %}
-    if {{ name }} > {{ num['lte'] }} and {{ name }} <= {{ num['gt'] }}:
-        raise ValidationFailed(\"{{ name }} is not in range {{ num['gt'], num['lte'] }}\")
-            {%- endif -%}
-        {%- elif num.HasField('gte') %}
-            {%- if num['lte'] > num['gte'] %}
-    if {{ name }} < {{ num['gte'] }} or {{ name }} > {{ num ['lte'] }}:
-        raise ValidationFailed(\"{{ name }} is not in range {{ num['lte'], num['gte'] }}\")
-            {%- else %}
-    if {{ name }} > {{ num['lte'] }} and {{ name }} < {{ num['gte'] }}:
-        raise ValidationFailed(\"{{ name }} is not in range {{ num['gte'], num['lte'] }}\")
-            {%- endif -%}
-        {%- else %}
-    if {{ name }} > {{ num['lte'] }}:
-        raise ValidationFailed(\"{{ name }} is not lesser than or equal to {{ num['lte'] }}\")
-        {%- endif -%}
-    {%- elif num.HasField('gt') %}
-    if {{ name }} <= {{ num['gt'] }}:
-        raise ValidationFailed(\"{{ name }} is not greater than {{ num['gt'] }}\")
-    {%- elif num.HasField('gte') %}
-    if {{ name }} < {{ num['gte'] }}:
-        raise ValidationFailed(\"{{ name }} is not greater than or equal to {{ num['gte'] }}\")
-    {%- endif -%}
-    {% endfilter %}
-    """
-    return Template(num_tmpl).render(o=option_value, name=name, num=num, in_template=in_template, str=str)
-
-
-def dur_arr(dur):
-    value = 0
-    arr = []
-    for val in dur:
-        value += val.seconds
-        value += (10**-9 * val.nanos)
-        arr.append(value)
-        value = 0
-    return arr
-
-
-def dur_lit(dur):
-    value = dur.seconds + (10**-9 * dur.nanos)
-    return value
-
-
-def duration_template(option_value, name, repeated=False):
-    dur_tmpl = """
-    {{- required_template(o.duration, name) }}
-    {% if repeated %}
-    if {{ name }}:
-    {% else %}
-    if _has_field(p, \"{{ name.split('.')[-1] }}\"):
-    {% endif %}
-        dur = {{ name }}.seconds + round((10**-9 * {{ name }}.nanos), 9)
-        {%- set dur = o.duration -%}
-        {%- if dur.HasField('lt') %}
-        lt = {{ dur_lit(dur['lt']) }}
-        {% endif %}
-        {%- if dur.HasField('lte') %}
-        lte = {{ dur_lit(dur['lte']) }}
-        {% endif %}
-        {%- if dur.HasField('gt') %}
-        gt = {{ dur_lit(dur['gt']) }}
-        {% endif %}
-        {%- if dur.HasField('gte') %}
-        gte = {{ dur_lit(dur['gte']) }}
-        {% endif %}
-        {%- if dur.HasField('const') %}
-        if dur != {{ dur_lit(dur['const']) }}:
-            raise ValidationFailed(\"{{ name }} is not equal to {{ dur_lit(dur['const']) }}\")
-        {%- endif -%}
-        {%- if dur['in'] %}
-        if dur not in {{ dur_arr(dur['in']) }}:
-            raise ValidationFailed(\"{{ name }} is not in {{ dur_arr(dur['in']) }}\")
-        {%- endif -%}
-        {%- if dur['not_in'] %}
-        if dur in {{ dur_arr(dur['not_in']) }}:
-            raise ValidationFailed(\"{{ name }} is not in {{ dur_arr(dur['not_in']) }}\")
-        {%- endif -%}
-        {%- if dur.HasField('lt') %}
-            {%- if dur.HasField('gt') %}
-                {%- if dur_lit(dur['lt']) > dur_lit(dur['gt']) %}
-        if dur <= gt or dur >= lt:
-            raise ValidationFailed(\"{{ name }} is not in range {{ dur_lit(dur['lt']), dur_lit(dur['gt']) }}\")
-                {%- else -%}
-        if dur >= lt and dur <= gt:
-            raise ValidationFailed(\"{{ name }} is not in range {{ dur_lit(dur['gt']), dur_lit(dur['lt']) }}\")
-                {%- endif -%}
-            {%- elif dur.HasField('gte') %}
-                {%- if dur_lit(dur['lt']) > dur_lit(dur['gte']) %}
-        if dur < gte or dur >= lt:
-            raise ValidationFailed(\"{{ name }} is not in range {{ dur_lit(dur['lt']), dur_lit(dur['gte']) }}\")
-                {%- else -%}
-        if dur >= lt and dur < gte:
-            raise ValidationFailed(\"{{ name }} is not in range {{ dur_lit(dur['gte']), dur_lit(dur['lt']) }}\")
-                {%- endif -%}
-            {%- else -%}
-        if dur >= lt:
-            raise ValidationFailed(\"{{ name }} is not lesser than {{ dur_lit(dur['lt']) }}\")
-            {%- endif -%}
-        {%- elif dur.HasField('lte') %}
-            {%- if dur.HasField('gt') %}
-                {%- if dur_lit(dur['lte']) > dur_lit(dur['gt']) %}
-        if dur <= gt or dur > lte:
-            raise ValidationFailed(\"{{ name }} is not in range {{ dur_lit(dur['lte']), dur_lit(dur['gt']) }}\")
-                {%- else -%}
-        if dur > lte and dur <= gt:
-            raise ValidationFailed(\"{{ name }} is not in range {{ dur_lit(dur['gt']), dur_lit(dur['lte']) }}\")
-                {%- endif -%}
-            {%- elif dur.HasField('gte') %}
-                {%- if dur_lit(dur['lte']) > dur_lit(dur['gte']) %}
-        if dur < gte or dur > lte:
-            raise ValidationFailed(\"{{ name }} is not in range {{ dur_lit(dur['lte']), dur_lit(dur['gte']) }}\")
-                {%- else -%}
-        if dur > lte and dur < gte:
-            raise ValidationFailed(\"{{ name }} is not in range {{ dur_lit(dur['gte']), dur_lit(dur['lte']) }}\")
-                {%- endif -%}
-            {%- else -%}
-        if dur > lte:
-            raise ValidationFailed(\"{{ name }} is not lesser than or equal to {{ dur_lit(dur['lte']) }}\")
-            {%- endif -%}
-        {%- elif dur.HasField('gt') %}
-        if dur <= gt:
-            raise ValidationFailed(\"{{ name }} is not greater than {{ dur_lit(dur['gt']) }}\")
-        {%- elif dur.HasField('gte') %}
-        if dur < gte:
-            raise ValidationFailed(\"{{ name }} is not greater than or equal to {{ dur_lit(dur['gte']) }}\")
-        {%- endif -%}
-    """
-    return Template(dur_tmpl).render(o=option_value, name=name, required_template=required_template,
-                                     dur_lit=dur_lit, dur_arr=dur_arr, repeated=repeated)
-
-
-def timestamp_template(option_value, name, repeated=False):
-    timestamp_tmpl = """
-    {{- required_template(o.timestamp, name) }}
-    {% if repeated %}
-    if {{ name }}:
-    {% else %}
-    if _has_field(p, \"{{ name.split('.')[-1] }}\"):
-    {% endif %}
-        ts = {{ name }}.seconds + round((10**-9 * {{ name }}.nanos), 9)
-        {%- set ts = o.timestamp -%}
-        {%- if ts.HasField('lt') %}
-        lt = {{ dur_lit(ts['lt']) }}
-        {% endif -%}
-        {%- if ts.HasField('lte') %}
-        lte = {{ dur_lit(ts['lte']) }}
-        {% endif -%}
-        {%- if ts.HasField('gt') %}
-        gt = {{ dur_lit(ts['gt']) }}
-        {% endif -%}
-        {%- if ts.HasField('gte') %}
-        gte = {{ dur_lit(ts['gte']) }}
-        {% endif -%}
-        {%- if ts.HasField('const') %}
-        if ts != {{ dur_lit(ts['const']) }}:
-            raise ValidationFailed(\"{{ name }} is not equal to {{ dur_lit(ts['const']) }}\")
-        {% endif %}
-        {%- if ts['in'] %}
-        if ts not in {{ dur_arr(ts['in']) }}:
-            raise ValidationFailed(\"{{ name }} is not in {{ dur_arr(ts['in']) }}\")
-        {%- endif %}
-        {%- if ts['not_in'] %}
-        if ts in {{ dur_arr(ts['not_in']) }}:
-            raise ValidationFailed(\"{{ name }} is not in {{ dur_arr(ts['not_in']) }}\")
-        {%- endif %}
-        {%- if ts.HasField('lt') %}
-            {%- if ts.HasField('gt') %}
-                {%- if dur_lit(ts['lt']) > dur_lit(ts['gt']) %}
-        if ts <= gt or ts >= lt:
-            raise ValidationFailed(\"{{ name }} is not in range {{ dur_lit(ts['lt']), dur_lit(ts['gt']) }}\")
-                {%- else -%}
-        if ts >= lt and ts <= gt:
-            raise ValidationFailed(\"{{ name }} is not in range {{ dur_lit(ts['gt']), dur_lit(ts['lt']) }}\")
-                {%- endif -%}
-            {%- elif ts.HasField('gte') %}
-                {%- if dur_lit(ts['lt']) > dur_lit(ts['gte']) %}
-        if ts < gte or ts >= lt:
-            raise ValidationFailed(\"{{ name }} is not in range {{ dur_lit(ts['lt']), dur_lit(ts['gte']) }}\")
-                {%- else -%}
-        if ts >= lt and ts < gte:
-            raise ValidationFailed(\"{{ name }} is not in range {{ dur_lit(ts['gte']), dur_lit(ts['lt']) }}\")
-                {%- endif -%}
-            {%- else -%}
-        if ts >= lt:
-            raise ValidationFailed(\"{{ name }} is not lesser than {{ dur_lit(ts['lt']) }}\")
-            {%- endif -%}
-        {%- elif ts.HasField('lte') %}
-            {%- if ts.HasField('gt') %}
-                {%- if dur_lit(ts['lte']) > dur_lit(ts['gt']) %}
-        if ts <= gt or ts > lte:
-            raise ValidationFailed(\"{{ name }} is not in range {{ dur_lit(ts['lte']), dur_lit(ts['gt']) }}\")
-                {%- else -%}
-        if ts > lte and ts <= gt:
-            raise ValidationFailed(\"{{ name }} is not in range {{ dur_lit(ts['gt']), dur_lit(ts['lte']) }}\")
-                {%- endif -%}
-            {%- elif ts.HasField('gte') %}
-                {%- if dur_lit(ts['lte']) > dur_lit(ts['gte']) %}
-        if ts < gte or ts > lte:
-            raise ValidationFailed(\"{{ name }} is not in range {{ dur_lit(ts['lte']), dur_lit(ts['gte']) }}\")
-                {%- else -%}
-        if ts > lte and ts < gte:
-            raise ValidationFailed(\"{{ name }} is not in range {{ dur_lit(ts['gte']), dur_lit(ts['lte']) }}\")
-                {%- endif -%}
-            {%- else -%}
-        if ts > lte:
-            raise ValidationFailed(\"{{ name }} is not lesser than or equal to {{ dur_lit(ts['lte']) }}\")
-            {%- endif -%}
-        {%- elif ts.HasField('gt') %}
-        if ts <= gt:
-            raise ValidationFailed(\"{{ name }} is not greater than {{ dur_lit(ts['gt']) }}\")
-        {%- elif ts.HasField('gte') %}
-        if ts < gte:
-            raise ValidationFailed(\"{{ name }} is not greater than or equal to {{ dur_lit(ts['gte']) }}\")
-        {%- elif ts.HasField('lt_now') %}
-        now = time.time()
-            {%- if ts.HasField('within') %}
-        within = {{ dur_lit(ts['within']) }}
-        if ts >= now or ts <= now - within:
-            raise ValidationFailed(\"{{ name }} is not within range {{ dur_lit(ts['within']) }}\")
-            {%- else %}
-        if ts >= now:
-            raise ValidationFailed(\"{{ name }} is not lesser than now\")
-            {%- endif -%}
-        {%- elif ts.HasField('gt_now') %}
-        now = time.time()
-            {%- if ts.HasField('within') %}
-        within = {{ dur_lit(ts['within']) }}
-        if ts <= now or ts >= now + within:
-            raise ValidationFailed(\"{{ name }} is not within range {{ dur_lit(ts['within']) }}\")
-            {%- else %}
-        if ts <= now:
-            raise ValidationFailed(\"{{ name }} is not greater than now\")
-            {%- endif -%}
-        {%- elif ts.HasField('within') %}
-        now = time.time()
-        within = {{ dur_lit(ts['within']) }}
-        if ts >= now + within or ts <= now - within:
-             raise ValidationFailed(\"{{ name }} is not within range {{ dur_lit(ts['within']) }}\")
-        {%- endif -%}
-    """
-    return Template(timestamp_tmpl).render(o=option_value, name=name, required_template=required_template,
-                                           dur_lit=dur_lit, dur_arr=dur_arr, repeated=repeated)
-
-
-def wrapper_template(option_value, name, repeated=False):
-    wrapper_tmpl = """
-    {% if repeated %}
-    if {{ name }}:
-    {% else %}
-    if p.HasField(\"{{ name[2:] }}\"):
-    {% endif %}
-        {%- if str(option_value.float) %}
-        {{- num_template(option_value, name + ".value", option_value.float)|indent(4,True) -}}
-        {% endif -%}
-        {%- if str(option_value.double) %}
-        {{- num_template(option_value, name + ".value", option_value.double)|indent(4,True) -}}
-        {% endif -%}
-        {%- if str(option_value.int32) %}
-        {{- num_template(option_value, name + ".value", option_value.int32)|indent(4,True) -}}
-        {% endif -%}
-        {%- if str(option_value.int64) %}
-        {{- num_template(option_value, name + ".value", option_value.int64)|indent(4,True) -}}
-        {% endif -%}
-        {%- if str(option_value.uint32) %}
-        {{- num_template(option_value, name + ".value", option_value.uint32)|indent(4,True) -}}
-        {% endif -%}
-        {%- if str(option_value.uint64) %}
-        {{- num_template(option_value, name + ".value", option_value.uint64)|indent(4,True) -}}
-        {% endif -%}
-        {%- if str(option_value.bool) %}
-        {{- bool_template(option_value, name + ".value")|indent(4,True) -}}
-        {% endif -%}
-        {%- if str(option_value.string) %}
-        {{- string_template(option_value, name + ".value")|indent(4,True) -}}
-        {% endif -%}
-        {%- if str(option_value.bytes) %}
-        {{- bytes_template(option_value, name + ".value")|indent(4,True) -}}
-        {% endif -%}
-    {%- if str(option_value.message) and option_value.message['required'] %}
-    else:
-        raise ValidationFailed(\"{{ name }} is required.\")
-    {%- endif %}
-    """
-    return Template(wrapper_tmpl).render(option_value=option_value, name=name, str=str, num_template=num_template,
-                                         bool_template=bool_template, string_template=string_template,
-                                         bytes_template=bytes_template, repeated=repeated)
-
-
-def enum_values(field):
-    return [x.number for x in field.enum_type.values]
-
-
-def enum_template(option_value, name, field):
-    enum_tmpl = """
-    {{ const_template(option_value, name) -}}
-    {{ in_template(option_value.enum, name) -}}
-    {% if option_value.enum['defined_only'] %}
-    if {{ name }} not in {{ enum_values(field) }}:
-        raise ValidationFailed(\"{{ name }} is not defined\")
-    {% endif %}
-    """
-    return Template(enum_tmpl).render(option_value=option_value, name=name, const_template=const_template,
-                                      in_template=in_template, field=field, enum_values=enum_values)
-
-
-def any_template(option_value, name, repeated=False):
-    any_tmpl = """
-    {{- required_template(o, name) }}
-    {%- if o['in'] %}
-    {% if repeated %}
-    if {{ name }}:
-    {% else %}
-    if _has_field(p, \"{{ name.split('.')[-1] }}\"):
-    {% endif %}
-        if {{ name }}.type_url not in {{ o['in'] }}:
-            raise ValidationFailed(\"{{ name }} not in {{ o['in'] }}\")
-    {%- endif %}
-    {%- if o['not_in'] %}
-    {% if repeated %}
-    if {{ name }}:
-    {% else %}
-    if _has_field(p, \"{{ name.split('.')[-1] }}\"):
-    {% endif %}
-        if {{ name }}.type_url in {{ o['not_in'] }}:
-            raise ValidationFailed(\"{{ name }} in {{ o['not_in'] }}\")
-    {%- endif %}
-    """
-    return Template(any_tmpl).render(
-        o=option_value.any, name=name, required_template=required_template, repeated=repeated)
-
-
-def bytes_template(option_value, name):
-    bytes_tmpl = """
-    {% set i = 0 %}
-    {%- if b['ignore_empty'] -%}
-    if {{ name }}:
-    {% set i = 4 %}
-    {%- endif -%}
-    {% filter indent(i,True) %}
-    {{ const_template(o, name) -}}
-    {{ in_template(o.bytes, name) -}}
-    {%- if b['len'] %}
-    if len({{ name }}) != {{ b['len'] }}:
-        raise ValidationFailed(\"{{ name }} length does not equal {{ b['len'] }}\")
-    {%- endif -%}
-    {%- if b['min_len'] %}
-    if len({{ name }}) < {{ b['min_len'] }}:
-        raise ValidationFailed(\"{{ name }} length is less than {{ b['min_len'] }}\")
-    {%- endif -%}
-    {%- if b['max_len'] %}
-    if len({{ name }}) > {{ b['max_len'] }}:
-        raise ValidationFailed(\"{{ name }} length is more than {{ b['max_len'] }}\")
-    {%- endif -%}
-    {%- if b['ip'] %}
-    try:
-        ip_address({{ name }})
-    except ValueError:
-        raise ValidationFailed(\"{{ name }} is not a valid ip\")
-    {%- endif -%}
-    {%- if b['ipv4'] %}
-    try:
-        IPv4Address({{ name }})
-    except ValueError:
-        raise ValidationFailed(\"{{ name }} is not a valid ipv4\")
-    {%- endif -%}
-    {%- if b['ipv6'] %}
-    try:
-        IPv6Address({{ name }})
-    except ValueError:
-        raise ValidationFailed(\"{{ name }} is not a valid ipv6\")
-    {%- endif -%}
-    {% if b['pattern'] %}
-        {% if sys.version_info[0] >= 3%}
-    if re.search({{ b['pattern'].encode('unicode-escape') }}, {{ name }}) is None:
-        raise ValidationFailed(\"{{ name }} pattern does not match b['pattern'].encode('unicode-escape')\")
-        {% else %}
-    if re.search(b\"{{ b['pattern'].encode('unicode-escape') }}\", {{ name }}) is None:
-        raise ValidationFailed(\"{{ name }} pattern does not match \")
-        {% endif %}
-    {% endif %}
-    {% if b['contains'] %}
-        {% if sys.version_info[0] >= 3 %}
-    if not {{ b['contains'] }} in {{ name }}:
-        raise ValidationFailed(\"{{ name }} does not contain {{ b['contains'] }}\")
-        {% else %}
-    if not b\"{{ b['contains'].encode('string_escape') }}\" in {{ name }}:
-        raise ValidationFailed(\"{{ name }} does not contain \")
-        {% endif %}
-    {% endif %}
-    {% if b['prefix'] %}
-        {% if sys.version_info[0] >= 3 %}
-    if not {{ name }}.startswith({{ b['prefix'] }}):
-        raise ValidationFailed(\"{{ name }} does not start with prefix {{ b['prefix'] }}\")
-        {% else %}
-    if not {{name}}.startswith(b\"{{ b['prefix'].encode('string_escape') }}\"):
-        raise ValidationFailed(\"{{ name }} does not start with prefix {{ b['prefix'].encode('string_escape') }}\")
-        {% endif %}
-    {% endif %}
-    {% if b['suffix'] %}
-        {% if sys.version_info[0] >= 3 %}
-    if not {{ name }}.endswith({{ b['suffix'] }}):
-        raise ValidationFailed(\"{{ name }} does not end with suffix {{ b['suffix'] }}\")
-        {% else %}
-    if not {{name}}.endswith(b\"{{ b['suffix'].encode('string_escape') }}\"):
-        raise ValidationFailed(\"{{ name }} does not end with suffix {{ b['suffix'] }}\")
-        {% endif %}
-    {% endif %}
-    {% endfilter %}
-    """
-    return Template(bytes_tmpl).render(sys=sys, o=option_value, name=name,
-                                       const_template=const_template, in_template=in_template, b=option_value.bytes)
-
-
-def switcher_template(accessor, name, field, map=False):
-    switcher_tmpl = """
-    {%- if str(accessor.float) %}
-    {{- num_template(accessor, name, accessor.float)|indent(4,True) -}}
-    {%- elif str(accessor.double) %}
-    {{- num_template(accessor, name, accessor.double)|indent(4,True) -}}
-    {%- elif str(accessor.int32) %}
-    {{- num_template(accessor, name, accessor.int32)|indent(4,True) -}}
-    {%- elif str(accessor.int64) %}
-    {{- num_template(accessor, name, accessor.int64)|indent(4,True) -}}
-    {%- elif str(accessor.uint32) %}
-    {{- num_template(accessor, name, accessor.uint32)|indent(4,True) -}}
-    {%- elif str(accessor.uint64) %}
-    {{- num_template(accessor, name, accessor.uint64)|indent(4,True) -}}
-    {%- elif str(accessor.sint32) %}
-    {{- num_template(accessor, name, accessor.sint32)|indent(4,True) -}}
-    {%- elif str(accessor.sint64) %}
-    {{- num_template(accessor, name, accessor.sint64)|indent(4,True) -}}
-    {%- elif str(accessor.fixed32) %}
-    {{- num_template(accessor, name, accessor.fixed32)|indent(4,True) -}}
-    {%- elif str(accessor.fixed64) %}
-    {{- num_template(accessor, name, accessor.fixed64)|indent(4,True) -}}
-    {%- elif str(accessor.sfixed32) %}
-    {{- num_template(accessor, name, accessor.sfixed32)|indent(4,True) -}}
-    {%- elif str(accessor.sfixed64) %}
-    {{- num_template(accessor, name, accessor.sfixed64)|indent(4,True) -}}
-    {%- elif str(accessor.bool) %}
-    {{- bool_template(accessor, name)|indent(4,True) -}}
-    {%- elif str(accessor.string) %}
-    {{- string_template(accessor, name)|indent(4,True) -}}
-    {%- elif str(accessor.enum) and map %}
-    {{- enum_template(accessor, name, field.message_type.fields[1])|indent(4,True) -}}
-    {%- elif str(accessor.enum) and not map %}
-    {{- enum_template(accessor, name, field)|indent(4,True) -}}
-    {%- elif str(accessor.duration) %}
-    {{- duration_template(accessor, name, True)|indent(4,True) -}}
-    {%- elif str(accessor.timestamp) %}
-    {{- timestamp_template(accessor, name, True)|indent(4,True) -}}
-    {%- elif str(accessor.message) %}
-    {{- message_template(accessor, name, True)|indent(4,True) -}}
-    {%- elif str(accessor.any) %}
-    {{- any_template(accessor, name, True)|indent(4,True) -}}
-    {%- elif str(accessor.message) %}
-    {{- message_template(accessor, name, True)|indent(4,True) -}}
-    {%- endif %}
-    """
-    return Template(switcher_tmpl).render(accessor=accessor, name=name, str=str, num_template=num_template,
-                                          bool_template=bool_template, string_template=string_template,
-                                          enum_template=enum_template, duration_template=duration_template,
-                                          timestamp_template=timestamp_template, any_template=any_template,
-                                          message_template=message_template, field=field, map=map)
-
-
-def repeated_template(option_value, name, field):
-    rep_tmpl = """
-    {% set i = 0 %}
-    {%- if o and o.repeated['ignore_empty'] %}
-    if {{ name }}:
-    {% set i = 4 %}
-    {%- endif -%}
-    {% filter indent(i,True) %}
-    {%- if o and o.repeated['min_items'] %}
-    if len({{ name }}) < {{ o.repeated['min_items'] }}:
-        raise ValidationFailed(\"{{ name }} needs to contain at least {{ o.repeated['min_items'] }} items\")
-    {%- endif %}
-    {%- if o and o.repeated['max_items'] %}
-    if len({{ name }}) > {{ o.repeated['max_items'] }}:
-        raise ValidationFailed(\"{{ name }} needs to contain at most {{ o.repeated['max_items'] }} items\")
-    {%- endif %}
-    {%- if o and o.repeated['unique'] %}
-    seen = set()
-    for item in {{ name }}:
-        if item in seen:
-            raise ValidationFailed(\"{{ name }} must contain unique items. %s has been repeated.\" %item)
-        else:
-            seen.add(item)
-    {%- endif %}
-    {%- if message_type %}
-    for item in {{ name }}:
-        {%- if o and o.repeated and o.repeated.items.message.skip %}
-        pass
-        {% else %}
-        validate(item)
-        {% endif %}
-    {%- endif %}
-    {%- if o and str(o.repeated['items']) %}
-    for item in {{ name }}:
-        {%- set accessor = o.repeated['items'] -%}
-        {{ switcher_template(accessor, 'item', field) }}
-        pass
-    {%- endif %}
-    {% endfilter %}
-    """
-    return Template(rep_tmpl).render(o=option_value, name=name, message_type=field.message_type,
-                                     str=str, field=field, switcher_template=switcher_template)
-
-
-def is_map(field):
-    return field.label == 3 and field.message_type and len(field.message_type.fields) == 2 and \
-        field.message_type.fields[0].name == "key" and field.message_type.fields[1].name == "value"
-
-
-def map_template(option_value, name, field):
-    map_tmpl = """
-    {% set i = 0 %}
-    {%- if o and o.map['ignore_empty'] %}
-    if {{ name }}:
-    {% set i = 4 %}
-    {%- endif -%}
-    {% filter indent(i,True) %}
-    {%- if o and o.map['min_pairs'] %}
-    if len({{ name }}) < {{ o.map['min_pairs'] }}:
-        raise ValidationFailed(\"{{ name }} needs to contain at least {{ o.map['min_pairs'] }} items\")
-    {%- endif %}
-    {%- if o and o.map['max_pairs'] %}
-    if len({{ name }}) > {{ o.map['max_pairs'] }}:
-        raise ValidationFailed(\"{{ name }} can contain at most {{ o.map['max_pairs'] }} items\")
-    {%- endif %}
-    {%- if o and (str(o.map['keys']) or str(o.map['values']))%}
-    for key in {{ name }}:
-        {%- set keys = o.map['keys'] -%}
-        {%- set values = o.map['values'] -%}
-        {%- if str(keys.double) %}
-        {{- num_template(keys, 'key', keys.double)|indent(4,True) -}}
-        {%- elif str(keys.int32) %}
-        {{- num_template(keys, 'key', keys.int32)|indent(4,True) -}}
-        {%- elif str(keys.int64) %}
-        {{- num_template(keys, 'key', keys.int64)|indent(4,True) -}}
-        {%- elif str(keys.uint32) %}
-        {{- num_template(keys, 'key', keys.uint32)|indent(4,True) -}}
-        {%- elif str(keys.uint64) %}
-        {{- num_template(keys, 'key', keys.uint64)|indent(4,True) -}}
-        {%- elif str(keys.sint32) %}
-        {{- num_template(keys, 'key', keys.sint32)|indent(4,True) -}}
-        {%- elif str(keys.sint64) %}
-        {{- num_template(keys, 'key', keys.sint64)|indent(4,True) -}}
-        {%- elif str(keys.fixed32) %}
-        {{- num_template(keys, 'key', keys.fixed32)|indent(4,True) -}}
-        {%- elif str(keys.fixed64) %}
-        {{- num_template(keys, 'key', keys.fixed64)|indent(4,True) -}}
-        {%- elif str(keys.sfixed32) %}
-        {{- num_template(keys, 'key', keys.sfixed32)|indent(4,True) -}}
-        {%- elif str(keys.sfixed64) %}
-        {{- num_template(keys, 'key', keys.sfixed64)|indent(4,True) -}}
-        {%- elif str(keys.bool) %}
-        {{- bool_template(keys, 'key')|indent(4,True) -}}
-        {%- elif str(keys.string) %}
-        {{- string_template(keys, 'key')|indent(4,True) -}}
-        {%- endif %}
-        {%- set values = o.map['values'] -%}
-        {{ switcher_template(values, name +'[key]', field, True) }}
-        pass
-    {%- elif field.message_type.fields[1].message_type %}
-    for key in {{ name }}:
-        validate({{ name }}[key])
-    {%- endif %}
-    {% endfilter %}
-    """
-    return Template(map_tmpl).render(o=option_value, name=name, message_type=field.message_type, str=str,
-                                     field=field, switcher_template=switcher_template, num_template=num_template,
-                                     string_template=string_template, bool_template=bool_template)
-
-
-def rule_type(field):
-    name = "p." + field.name
-    if has_validate(field) and field.message_type is None:
-        for option_descriptor, option_value in field.GetOptions().ListFields():
-            if option_descriptor.full_name == "validate.rules":
-                if str(option_value.string):
-                    return string_template(option_value, name)
-                elif str(option_value.message):
-                    return message_template(option_value, field.name)
-                elif str(option_value.bool):
-                    return bool_template(option_value, name)
-                elif str(option_value.float):
-                    return num_template(option_value, name, option_value.float)
-                elif str(option_value.double):
-                    return num_template(option_value, name, option_value.double)
-                elif str(option_value.int32):
-                    return num_template(option_value, name, option_value.int32)
-                elif str(option_value.int64):
-                    return num_template(option_value, name, option_value.int64)
-                elif str(option_value.uint32):
-                    return num_template(option_value, name, option_value.uint32)
-                elif str(option_value.uint64):
-                    return num_template(option_value, name, option_value.uint64)
-                elif str(option_value.sint32):
-                    return num_template(option_value, name, option_value.sint32)
-                elif str(option_value.sint64):
-                    return num_template(option_value, name, option_value.sint64)
-                elif str(option_value.fixed32):
-                    return num_template(option_value, name, option_value.fixed32)
-                elif str(option_value.fixed64):
-                    return num_template(option_value, name, option_value.fixed64)
-                elif str(option_value.sfixed32):
-                    return num_template(option_value, name, option_value.sfixed32)
-                elif str(option_value.sfixed64):
-                    return num_template(option_value, name, option_value.sfixed64)
-                elif str(option_value.enum):
-                    return enum_template(option_value, name, field)
-                elif str(option_value.bytes):
-                    return bytes_template(option_value, name)
-                elif str(option_value.repeated):
-                    return repeated_template(option_value, name, field)
-                elif str(option_value.map):
-                    return map_template(option_value, name, field)
-                elif str(option_value.required):
-                    return required_template(option_value, name)
-    if field.message_type:
-        for option_descriptor, option_value in field.GetOptions().ListFields():
-            if option_descriptor.full_name == "validate.rules":
-                if str(option_value.duration):
-                    return duration_template(option_value, name)
-                elif str(option_value.timestamp):
-                    return timestamp_template(option_value, name)
-                elif str(option_value.float) or str(option_value.int32) or str(option_value.int64) or \
-                        str(option_value.double) or str(option_value.uint32) or str(option_value.uint64) or \
-                        str(option_value.bool) or str(option_value.string) or str(option_value.bytes):
-                    return wrapper_template(option_value, name)
-                elif str(option_value.message) != "":
-                    return message_template(option_value, field.name)
-                elif str(option_value.any):
-                    return any_template(option_value, name)
-                elif str(option_value.repeated):
-                    return repeated_template(option_value, name, field)
-                elif str(option_value.map):
-                    return map_template(option_value, name, field)
-                elif str(option_value.required):
-                    return required_template(option_value, name)
-        if field.message_type.full_name.startswith("google.protobuf"):
-            return ""
-        elif is_map(field):
-            return map_template(None, name, field)
-        elif field.label == 3:
-            return repeated_template(None, name, field)
-        else:
-            return message_template(None, field.name)
-    return ""
-
-
-def file_template(proto_message):
-    file_tmp = """
-# Validates {{ p.DESCRIPTOR.name }}
-def generate_validate(p):
-    {%- for option_descriptor, option_value in p.DESCRIPTOR.GetOptions().ListFields() %}
-        {%- if option_descriptor.full_name == "validate.disabled" and option_value %}
-    return None
-        {%- elif option_descriptor.full_name == "validate.ignored" and option_value %}
-    return None
-        {%- endif -%}
-    {%- endfor -%}
-    {%- for oneof in p.DESCRIPTOR.oneofs %}
-    present = False
-        {%- for field in oneof.fields %}
-    if _has_field(p, \"{{ field.name }}\"):
-        present = True
-        {{ rule_type(field)|indent(4,True) }}
-        {%- endfor %}
-        {% for option in oneof.GetOptions().ListFields() %}
-        {% if option[0].name == 'required' and option[1] %}
-    if not present:
-        raise ValidationFailed(\"Oneof {{ oneof.name }} is required\")
-        {% endif %}
-        {% endfor %}
-    {%- endfor %}
-    {%- for field in p.DESCRIPTOR.fields -%}
-        {%- if not field.containing_oneof %}
-    {{ rule_type(field) -}}
-        {%- endif %}
-    {%- endfor %}
-    return None"""
-    return Template(file_tmp).render(rule_type=rule_type, p=proto_message)
diff -ruN 1/python/pyproject.toml 2/python/pyproject.toml
--- 1/python/pyproject.toml	2022-05-24 19:15:05.648007688 +0000
+++ 2/python/pyproject.toml	1970-01-01 00:00:00.000000000 +0000
@@ -1,6 +0,0 @@
-[build-system]
-requires = [
-    "setuptools>=42",
-    "wheel"
-]
-build-backend = "setuptools.build_meta"
diff -ruN 1/python/requirements.in 2/python/requirements.in
--- 1/python/requirements.in	2022-05-24 19:15:05.652007675 +0000
+++ 2/python/requirements.in	1970-01-01 00:00:00.000000000 +0000
@@ -1,6 +0,0 @@
-# These must be the same as the requirements listed in
-# install_requires section of setup.cfg. A test checks for this.
-# See requirements_test.py for more context.
-validate-email>=1.3
-Jinja2>=2.11.1
-protobuf>=3.6.1
diff -ruN 1/python/setup.cfg 2/python/setup.cfg
--- 1/python/setup.cfg	2022-05-24 19:15:05.656007660 +0000
+++ 2/python/setup.cfg	1970-01-01 00:00:00.000000000 +0000
@@ -1,32 +0,0 @@
-[metadata]
-name = protoc-gen-validate
-version = 0.4.2
-author = Envoyproxy
-author_email = dev@lyft.com
-description = PGV for python via just-in-time code generation
-long_description = file: README.md
-long_description_content_type = text/markdown
-url = https://github.com/envoyproxy/protoc-gen-validate
-license_files = LICENSE
-classifiers =
-    Programming Language :: Python :: 3
-    Programming Language :: Python :: 3 :: Only
-    Programming Language :: Python :: 3.6
-    Programming Language :: Python :: 3.7
-    Programming Language :: Python :: 3.8
-
-[options]
-packages = find:
-install_requires =
-    validate-email>=1.3
-    Jinja2>=2.11.1
-    protobuf>=3.6.1
-python_requires = >=3.6
-
-[options.data_files]
-data = validate.proto
-
-[flake8]
-max-line-length = 120
-ignore =
-    F401  # unused imports
diff -ruN 1/validate/BUILD.in 2/validate/BUILD.in
--- 1/validate/BUILD.in	1970-01-01 00:00:00.000000000 +0000
+++ 2/validate/BUILD.in	2022-05-24 19:15:06.400005045 +0000
@@ -0,0 +1,4 @@
+exports_files([
+    "validate.h",
+    "validate.proto",
+])
diff -ruN 1/windows/bazel.rc 2/windows/bazel.rc
--- 1/windows/bazel.rc	2022-05-24 19:15:05.972006549 +0000
+++ 2/windows/bazel.rc	1970-01-01 00:00:00.000000000 +0000
@@ -1 +0,0 @@
-build --verbose_failures
diff -ruN 1/windows/ci.ps1 2/windows/ci.ps1
--- 1/windows/ci.ps1	2022-05-24 19:15:05.976006536 +0000
+++ 2/windows/ci.ps1	1970-01-01 00:00:00.000000000 +0000
@@ -1,7 +0,0 @@
-$ErrorActionPreference = "Stop";
-trap { $host.SetShouldExit(1) }
-
-#bazel-harness
-# runs the test harness via bazel
-bazel "--output_base=c:\_pgv" "--bazelrc=windows\bazel.rc" run //tests/harness/executor:executor
-exit $LASTEXITCODE
