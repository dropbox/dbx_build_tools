cc_binary(
    name = "mksquashfs",
    srcs = [
        "squashfs-tools/action.c",
        "squashfs-tools/action.h",
        "squashfs-tools/caches-queues-lists.c",
        "squashfs-tools/caches-queues-lists.h",
        "squashfs-tools/compressor.c",
        "squashfs-tools/compressor.h",
        "squashfs-tools/endian_compat.h",
        "squashfs-tools/error.h",
        "squashfs-tools/fnmatch_compat.h",
        "squashfs-tools/gzip_wrapper.c",
        "squashfs-tools/gzip_wrapper.h",
        "squashfs-tools/info.c",
        "squashfs-tools/info.h",
        "squashfs-tools/lz4_wrapper.c",
        "squashfs-tools/lz4_wrapper.h",
        "squashfs-tools/mksquashfs.c",
        "squashfs-tools/mksquashfs.h",
        "squashfs-tools/mksquashfs_error.h",
        "squashfs-tools/process_fragments.c",
        "squashfs-tools/process_fragments.h",
        "squashfs-tools/progressbar.c",
        "squashfs-tools/progressbar.h",
        "squashfs-tools/pseudo.c",
        "squashfs-tools/pseudo.h",
        "squashfs-tools/read_fs.c",
        "squashfs-tools/read_fs.h",
        "squashfs-tools/read_xattrs.c",
        "squashfs-tools/reader.c",
        "squashfs-tools/restore.c",
        "squashfs-tools/restore.h",
        "squashfs-tools/sort.c",
        "squashfs-tools/sort.h",
        "squashfs-tools/squashfs_fs.h",
        "squashfs-tools/squashfs_swap.h",
        "squashfs-tools/swap.c",
        "squashfs-tools/tar.c",
        "squashfs-tools/tar.h",
        "squashfs-tools/tar_xattr.c",
        "squashfs-tools/xattr.c",
        "squashfs-tools/xattr.h",
        "squashfs-tools/zstd_wrapper.c",
        "squashfs-tools/zstd_wrapper.h",
    ],
    copts = [
        "-D_FILE_OFFSET_BITS=64",
        "-D_LARGEFILE_SOURCE",
        "-D_GNU_SOURCE",
        "-DCOMP_DEFAULT=\\\"gzip\\\"",
        "-DXATTR_SUPPORT",
        "-DXATTR_DEFAULT",
        "-DREPRODUCIBLE_DEFAULT",
        "-DGZIP_SUPPORT",
        "-DLZ4_SUPPORT",
        "-DZSTD_SUPPORT",
        "-DVERSION=\\\"4.5.1\\\"",  # from squashfs-tools/Makefile:2
        "-DDATE=\\\"2022/03/17\\\"",  # from squashfs-tools/Makefile:3
    ],
    linkopts = [
        "-pthread",
    ],
    visibility = ["//visibility:public"],
    deps = [
        "@lz4",
        "@net_zlib//:zlib",
        "@zstd",
    ],
)

cc_binary(
    name = "unsquashfs",
    srcs = [
        "squashfs-tools/compressor.c",
        "squashfs-tools/compressor.h",
        "squashfs-tools/endian_compat.h",
        "squashfs-tools/error.h",
        "squashfs-tools/fnmatch_compat.h",
        "squashfs-tools/gzip_wrapper.c",
        "squashfs-tools/gzip_wrapper.h",
        "squashfs-tools/lz4_wrapper.c",
        "squashfs-tools/lz4_wrapper.h",
        "squashfs-tools/read_xattrs.c",
        "squashfs-tools/squashfs_compat.h",
        "squashfs-tools/squashfs_fs.h",
        "squashfs-tools/squashfs_swap.h",
        "squashfs-tools/swap.c",
        "squashfs-tools/unsquash-1.c",
        "squashfs-tools/unsquash-123.c",
        "squashfs-tools/unsquash-2.c",
        "squashfs-tools/unsquash-3.c",
        "squashfs-tools/unsquash-34.c",
        "squashfs-tools/unsquash-4.c",
        "squashfs-tools/unsquashfs.c",
        "squashfs-tools/unsquashfs.h",
        "squashfs-tools/unsquashfs_error.h",
        "squashfs-tools/unsquashfs_info.c",
        "squashfs-tools/unsquashfs_info.h",
        "squashfs-tools/unsquashfs_xattr.c",
        "squashfs-tools/xattr.h",
        "squashfs-tools/zstd_wrapper.c",
        "squashfs-tools/zstd_wrapper.h",
    ],
    copts = [
        "-D_FILE_OFFSET_BITS=64",
        "-D_LARGEFILE_SOURCE",
        "-D_GNU_SOURCE",
        "-DCOMP_DEFAULT=\\\"gzip\\\"",
        "-DXATTR_SUPPORT",
        "-DXATTR_DEFAULT",
        "-DREPRODUCIBLE_DEFAULT",
        "-DGZIP_SUPPORT",
        "-DLZ4_SUPPORT",
        "-DZSTD_SUPPORT",
        "-DVERSION=\\\"4.5.1\\\"",  # from squashfs-tools/Makefile:2
        "-DDATE=\\\"2022/03/17\\\"",  # from squashfs-tools/Makefile:3
    ],
    linkopts = [
        "-pthread",
    ],
    visibility = ["//visibility:public"],
    deps = [
        "@lz4",
        "@net_zlib//:zlib",
        "@zstd",
    ],
)
